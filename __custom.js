//Update: 2024-01-30 05:05(GMT+8)

var Icon_url = "https://is1-ssl.mzstatic.com/image/thumb/Purple116/v4/6e/74/b9/6e74b9e2-1d45-6017-76d1-eb733918c537/AppIcon-1x_U007emarketing-0-5-0-85-220.png/120x120.png";

var ProcessName = "MHNow";
var search_lower_limit = "0x100000000";
var search_upper_limit = "0x160000000";

var black_diablos_addr = null;
var pukei_pukei_addr = null;
var armorName = null;
var armorlevel = null;

function has_number(s)
{
    if (!s || isNaN(s) || s === "" || /\s/g.test(s)){
        return false;
    }
    return true;
}

var armor_default_config = {"1-1":20,"1-2":22,"1-3":25,"1-4":27,"1-5":29,
                                            "2-1":34,"2-2":36,"2-3":39,"2-4":41,"2-5":44,
                                            "3-1":49,"3-2":52,"3-3":54,"3-4":57,"3-5":60,
                                            "4-1":65,"4-2":68,"4-3":71,"4-4":73,"4-5":76,
                                            "5-1":82,"5-2":85,"5-3":88,"5-4":91,"5-5":94,
                                            "6-1":100,"6-2":103,"6-3":106,"6-4":109,"6-5":113,
                                            "7-1":119,"7-2":122,"7-3":126,"7-4":129,"7-5":132,
                                            "8-1":139,"8-2":142,"8-3":146,"8-4":149,"8-5":153,
                                            "9-1":160,"9-2":164,"9-3":167,"9-4":171,"9-5":175,
                                            "10-1":182,"10-2":186,"10-3":190,"10-4":193,"10-5":197}

var armor_id = {
                            data:{
                                //毒妖鳥
                                "Pukei Pukei":{
                                 "1head":{"1":61, "2":62, "3":63, "4":64, "5":296, "6":297, "7":298, "8":299, "9":300, "10":301}
                                ,"2body":{"1":65, "2":66, "3":67, "4":68, "5":302, "6":303, "7":304, "8":305, "9":306, "10":307}
                                ,"3hand":{"1":69, "2":70, "3":71, "4":72, "5":308, "6":309, "7":310, "8":311, "9":312, "10":313}
                                ,"4waist":{"1":73, "2":74, "3":75, "4":76, "5":314, "6":315, "7":316, "8":317, "9":318, "10":319}
                                ,"5foot":  {"1":77, "2":78, "3":79, "4":80, "5":320, "6":321, "7":322, "8":323, "9":324, "10":325}
                                ,"under":1
                                },
                                //土砂龍
                                "Barroth":{
                                 "1head":{"1":141, "2":142, "3":143, "4":516, "5":517, "6":518, "7":519, "8":520, "9":521, "10":522}
                                ,"2body":{"1":144, "2":145, "3":146, "4":523, "5":524, "6":525, "7":526, "8":527, "9":528, "10":529}
                                ,"3hand":{"1":147, "2":148, "3":149, "4":530, "5":531, "6":532, "7":533, "8":534, "9":535, "10":536}
                                ,"4waist":{"1":150, "2":151, "3":152, "4":537, "5":538, "6":539, "7":540, "8":541, "9":542, "10":543}
                                ,"5foot":  {"1":153, "2":154, "3":155, "4":544, "5":545, "6":546, "7":547, "8":548, "9":549, "10":550}
                                ,"under":1
                                },
                                //大凶顎龍
                                "Great Girros":{
                                 "1head":{"2":157, "3":158, "4":551, "5":552, "6":553, "7":554, "8":555, "9":556, "10":557}
                                ,"2body":{"2":160, "3":161, "4":558, "5":559, "6":560, "7":561, "8":562, "9":563, "10":564}
                                ,"3hand":{"2":163, "3":164, "4":565, "5":566, "6":567, "7":568, "8":569, "9":570, "10":571}
                                ,"4waist":{"2":166, "3":167, "4":572, "5":573, "6":574, "7":575, "8":576, "9":577, "10":578}
                                ,"5foot":  {"2":169, "3":170, "4":579, "5":580, "6":581, "7":582, "8":583, "9":584, "10":585}
                                ,"under":2
                                },
                                //飛雷龍
                                "Tobi-Kadachi":{
                                 "1head":{"2":82, "3":83, "4":326, "5":327, "6":328, "7":329, "8":330, "9":331, "10":332}
                                ,"2body":{"2":85, "3":86, "4":333, "5":334, "6":335, "7":336, "8":337, "9":338, "10":339}
                                ,"3hand":{"2":88, "3":89, "4":340, "5":341, "6":342, "7":343, "8":344, "9":345, "10":346}
                                ,"4waist":{"2":91, "3":92, "4":347, "5":348, "6":349, "7":350, "8":351, "9":352, "10":353}
                                ,"5foot":  {"2":94, "3":95, "4":354, "5":355, "6":356, "7":357, "8":358, "9":359, "10":360},
                                "under":2
                                },
                                //浮空龍
                                "Paolumu":{
                                 "1head":{"3":188, "4":621, "5":622, "6":623, "7":624, "8":625, "9":626, "10":627}
                                ,"2body":{"3":191, "4":628, "5":629, "6":630, "7":631, "8":632, "9":633, "10":634}
                                ,"3hand":{"3":194, "4":635, "5":636, "6":637, "7":638, "8":639, "9":640, "10":641}
                                ,"4waist":{"3":197, "4":642, "5":643, "6":644, "7":645, "8":646, "9":647, "10":648}
                                ,"5foot":  {"3":200, "4":649, "5":650, "6":651, "7":652, "8":653, "9":654, "10":655}
                                ,"under":3
                                },
                                //泥魚龍
                                "Jyuratodus":{
                                 "1head":{"3":658, "4":659, "5":660, "6":661, "7":662, "8":663, "9":664, "10":665}
                                ,"2body":{"3":668, "4":669, "5":670, "6":671, "7":672, "8":673, "9":674, "10":675}
                                ,"3hand":{"3":678, "4":679, "5":680, "6":681, "7":682, "8":683, "9":684, "10":685}
                                ,"4waist":{"3":688, "4":689, "5":690, "6":691, "7":692, "8":693, "9":694, "10":695}
                                ,"5foot":  {"3":698, "4":699, "5":700, "6":701, "7":702, "8":703, "9":704, "10":705}
                                ,"under":3
                                },
                                //蠻顎龍
                                "Anjanath":{
                                 "1head":{"4":586, "5":587, "6":588, "7":589, "8":590, "9":591, "10":592}
                                ,"2body":{"4":593, "5":594, "6":595, "7":596, "8":597, "9":598, "10":599}
                                ,"3hand":{"4":600, "5":601, "6":602, "7":603, "8":604, "9":605, "10":606}
                                ,"4waist":{"4":607, "5":608, "6":609, "7":610, "8":611, "9":612, "10":613}
                                ,"5foot":  {"4":614, "5":615, "6":616, "7":617, "8":618, "9":619, "10":620}
                                ,"under":4
                                },
                                //雌火龍
                                "Rathian":{
                                 "1head":{"4":481, "5":482, "6":483, "7":484, "8":485, "9":486, "10":487}
                                ,"2body":{"4":488, "5":489, "6":490, "7":491, "8":492, "9":493, "10":494}
                                ,"3hand":{"4":495, "5":496, "6":497, "7":498, "8":499, "9":500, "10":501}
                                ,"4waist":{"4":502, "5":503, "6":504, "7":505, "8":506, "9":507, "10":508}
                                ,"5foot":  {"4":509, "5":510, "6":511, "7":512, "8":513, "9":514, "10":515}
                                ,"under":4
                                },
                                //櫻火龍
                                "Pink Rathian":{
                                 "1head":{"5":710, "6":711, "7":712, "8":713, "9":714, "10":715}
                                ,"2body":{"5":720, "6":721, "7":722, "8":723, "9":724, "10":725}
                                ,"3hand":{"5":730, "6":731, "7":732, "8":733, "9":734, "10":735}
                                ,"4waist":{"5":740, "6":741, "7":742, "8":743, "9":744, "10":745}
                                ,"5foot":  {"5":750, "6":751, "7":752, "8":753, "9":754, "10":755}
                                ,"under":5
                                },
                                //風漂龍
                                "Legiana":{
                                 "1head":{"5":403, "6":404, "7":405, "8":406, "9":407, "10":408}
                                ,"2body":{"5":411, "6":412, "7":413, "8":414, "9":415, "10":416}
                                ,"3hand":{"5":419, "6":420, "7":421, "8":422, "9":423, "10":424}
                                ,"4waist":{"5":427, "6":428, "7":429, "8":430, "9":431, "10":432}
                                ,"5foot":  {"5":435, "6":436, "7":437, "8":438, "9":439, "10":440}
                                ,"under":5
                                },
                                //角龍
                                "Diablos":{
                                 "1head":{"5":443, "6":444, "7":445, "8":446, "9":447, "10":448}
                                ,"2body":{"5":451, "6":452, "7":453, "8":454, "9":455, "10":456}
                                ,"3hand":{"5":459, "6":460, "7":461, "8":462, "9":463, "10":464}
                                ,"4waist":{"5":467, "6":468, "7":469, "8":470, "9":471, "10":472}
                                ,"5foot":  {"5":475, "6":476, "7":477, "8":478, "9":479, "10":480}
                                ,"under":5
                                },
                                //黑角龍??????
                                "Black Diablos":{
                                 "1head":{"5":810, "6":811, "7":812, "8":813, "9":814, "10":815}
                                ,"2body":{"5":820, "6":821, "7":822, "8":823, "9":824, "10":825}
                                ,"3hand":{"5":830, "6":831, "7":832, "8":833, "9":834, "10":835}
                                ,"4waist":{"5":840, "6":841, "7":842, "8":843, "9":844, "10":845}
                                ,"5foot":  {"5":850, "6":851, "7":852, "8":853, "9":854, "10":855}
                                ,"under":5
                                },
                                //火龍
                                "Rathalos":{
                                 "1head":{"5":363, "6":364, "7":365, "8":366, "9":367, "10":368}
                                ,"2body":{"5":371, "6":372, "7":373, "8":374, "9":375, "10":376}
                                ,"3hand":{"5":379, "6":380, "7":381, "8":382, "9":383, "10":384}
                                ,"4waist":{"5":387, "6":388, "7":389, "8":390, "9":391, "10":392}
                                ,"5foot":  {"5":395, "6":396, "7":397, "8":398, "9":399, "10":400}
                                ,"under":5
                                },
                                //蒼火龍
                                "Azure Rathalos":{
                                 "1head":{"5":760, "6":761, "7":762, "8":763, "9":764, "10":765}
                                ,"2body":{"5":770, "6":771, "7":772, "8":773, "9":774, "10":775}
                                ,"3hand":{"5":780, "6":781, "7":782, "8":783, "9":784, "10":785}
                                ,"4waist":{"5":790, "6":791, "7":792, "8":793, "9":794, "10":795}
                                ,"5foot":  {"5":800, "6":801, "7":802, "8":803, "9":804, "10":805}
                                ,"under":5
                                },
                                //骨槌龍
                                "Radobaan":{
                                 "1head":{"2":865, "3":866, "4":867, "5":868, "6":869, "7":870, "8":871, "9":872, "10":873}
                                ,"2body":{"2":874, "3":875, "4":876, "5":877, "6":878, "7":879, "8":880, "9":881, "10":882}
                                ,"3hand":{"2":883, "3":884, "4":885, "5":886, "6":887, "7":888, "8":889, "9":890, "10":891}
                                ,"4waist":{"2":892, "3":893, "4":894, "5":895, "6":896, "7":897, "8":898, "9":899, "10":900}
                                ,"5foot":  {"2":901, "3":902, "4":903, "5":904, "6":905, "7":906, "8":907, "9":908, "10":909}
                                ,"under":2
                                },
                                //猛牛龍
                                "Banbaro":{
                                 "1head":{"3":910, "4":911, "5":912, "6":913, "7":914, "8":915, "9":916, "10":917}
                                ,"2body":{"3":918, "4":919, "5":920, "6":921, "7":922, "8":923, "9":924, "10":925}
                                ,"3hand":{"3":926, "4":927, "5":928, "6":929, "7":930, "8":931, "9":932, "10":933}
                                ,"4waist":{"3":934, "4":935, "5":936, "6":937, "7":938, "8":939, "9":940, "10":941}
                                ,"5foot":  {"3":942, "4":943, "5":944, "6":945, "7":946, "8":947, "9":948, "10":949}
                                ,"under":3
                                },
                                //冰牙龍
                                "Barioth":{
                                 "1head":{"4":950, "5":951, "6":952, "7":953, "8":954, "9":955, "10":956}
                                ,"2body":{"4":957, "5":958, "6":959, "7":960, "8":961, "9":962, "10":963}
                                ,"3hand":{"4":964, "5":965, "6":966, "7":967, "8":968, "9":969, "10":970}
                                ,"4waist":{"4":971, "5":972, "6":973, "7":974, "8":975, "9":976, "10":977}
                                ,"5foot":  {"4":978, "5":979, "6":980, "7":981, "8":982, "9":983, "10":984}
                                ,"under":4
                                },
                                //雷狼龍
                                "Zinogre":{
                                 "1head":{"5":985, "6":986, "7":987, "8":988, "9":989, "10":990}
                                ,"2body":{"5":991, "6":992, "7":993, "8":994, "9":995, "10":996}
                                ,"3hand":{"5":997, "6":998, "7":999, "8":1000, "9":1001, "10":1002}
                                ,"4waist":{"5":1003, "6":1004, "7":1005, "8":1006, "9":1007, "10":1008}
                                ,"5foot":  {"5":1009, "6":1010, "7":1011, "8":1012, "9":1013, "10":1014}
                                ,"under":5
                                }
                            },
                         }
                         
function creat_armor_select(){
    try{
        if (Object.keys(armor_id['data']).length > 1){
            $(".select.group").prepend('<select class="select armor elem" onChange="select_armor(this);">')
            for (let item in armor_id['data']){
                $(".select.armor.elem").append('<option value="%v" class="select armor item">%v</option>'.replaceAll("%v",item));
            }
            $(".select.armor.elem").prepend('<option value="noselect">Select armor</option></select>');
            $('select.armor.elem option[value=noselect]').prop('selected', true);
        }
    } catch {}
}

function select_armor(element){
    armorName = null;
    if (element.value != "noselect"){
        // reset stage1 in to no selcect
        $(".select.grade.elem")[0].selectedIndex = 0;
        $(".select.grade.elem").show(); $(".nextstage.one").show(); $(".grade").show();
        let u = armor_id['data'][element.value]['under']
        armorName = element.value;
        switch (u){
            case 2:
                $(".grade-1").hide();
                break
            case 3:
                $(".grade-1").hide();
                $(".grade-2").hide();
                break
            case 4:
                $(".grade-1").hide();
                $(".grade-2").hide();
                $(".grade-3").hide();
            case 5:
                $(".grade-1").hide();
                $(".grade-2").hide();
                $(".grade-3").hide();
                $(".grade-4").hide();
            default:
                break
        }
    } else {
        $(".select.grade.elem").hide(); $(".nextstage.one").hide();
        armorName = null;
    }
    $(".nextstage.two").hide();
}

function select_armor_level(element){
    armorlevel = null;
    if (element.value != "noselect"){
        $(".nextstage.two").show();
        armorlevel = element.value;
    } else {
        $(".nextstage.two").hide();
        armorlevel = null;
    }
}

function armor_ok_to_modify(){
    if ( !has_number( $(".defValue").val() ) ){
        alert("only number!!!")
    } else {
        if ( modify_armor_def( $(".defValue").val() ) ){
            alert("修改成功");
            return;
        }
        alert("修改失敗");
    }
}

function modify_armor_def(modifyValue) {
    if (armor_default_config[armorlevel] && armor_id['data'][armorName]){
        var grade_level = armorlevel.split("-");
        var armor_type = $(".select.type.elem").val();
        
        var armor_orig_def = armor_default_config[armorlevel]; // armor def
        var armor_level = grade_level[1]; // armor level
        var armor_special_number = armor_id['data'][armorName][armor_type][grade_level[0]]; //armor special number
        
        console.log("armor：" + " grade: " + grade_level[0] + " level: " +armor_level + " id: " + armor_special_number + " orig def: " + armor_orig_def);
        
        //return;
        var p = getProcesIsExist(ProcessName);
        if (p) {
            h5gg.setTargetProc(p["pid"]);
            h5gg.clearResults();
            /*
            0x00    xx           // weapon special number
            0x04    xx          // weapon special number
            0x08    xx          // weapon level ex: grade 8: Lv.2/5 --> 2
            0x0C    xx         // weapon physical atk 
            0x10    xx         // weapon attribute atk
            */
            h5gg.searchNumber(armor_orig_def, "I32", search_lower_limit, search_upper_limit);
            
            h5gg.searchNearby(armor_special_number, "I32", "0x8");
            
            h5gg.searchNearby(armor_level, "I32", "0x4");
            
            //h5gg.searchNearby(0, "I32", "0x4");
            
            h5gg.searchNumber(armor_orig_def, "I32", search_lower_limit, search_upper_limit);
            
            var count = h5gg.getResultsCount();
            var results = h5gg.getResults(count);
            if (count > 0) {
                var ok = h5gg.setValue(results[0].address, modifyValue, "I32");
                if (ok) {
                    return true;
                }
            }
        }
        return false;
    }
}

